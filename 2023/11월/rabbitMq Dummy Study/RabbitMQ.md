# RabbitMQ Work Queue Tutorial

## 개요
이 튜토리얼에서는 RabbitMQ를 사용하여 작업 큐(Work Queue)를 구축하는 방법을 다룹니다. 작업 큐의 주요 목적은 리소스 집약적인 작업을 즉시 수행하는 대신 나중에 수행하도록 예약하는 것입니다. 이를 통해 여러 작업자(Worker)가 시간 소모적인 작업을 분담할 수 있습니다.

## 준비
- 이전 튜토리얼에서는 "Hello World!"라는 메시지를 전송했습니다.
- 이번에는 문자열을 사용하여 복잡한 작업을 나타냅니다. 예를 들어, "Hello..."라는 문자열은 3초 동안의 작업을 의미합니다 (각 점은 1초를 나타냄).

## 설정
- `tut2` 패키지를 생성하고, `Tut2Config`, `Tut2Receiver`, `Tut2Sender` 클래스를 만듭니다.
- `Tut2Config`에서는 큐를 설정하고, 두 개의 리시버(`Receiver1`, `Receiver2`)와 한 개의 센더(`Sender`)를 빈(Bean)으로 정의합니다.

### Sender
- `Tut2Sender`는 메시지에 점을 추가하여 작업의 길이를 나타냅니다.
- `convertAndSend` 메서드를 사용하여 메시지를 큐에 전송합니다.

### Receiver
- `Tut2Receiver`는 메시지를 받아서 처리합니다.
- 메시지에 있는 점의 개수만큼 `Thread.sleep()`을 호출하여 작업 시간을 시뮬레이션합니다.

## 실행
- Maven을 사용하여 패키지를 컴파일하고, 리시버와 센더를 각각 다른 쉘에서 실행합니다.

## 메시지 인정(Acknowledgment)
- Spring AMQP는 기본적으로 메시지 인정을 보수적으로 처리합니다.
- 리스너가 예외를 던지면 메시지는 재전송됩니다.
- 처리가 완료된 후에는 `channel.basicAck()`을 호출하여 인정합니다.

## 메시지 지속성
- Spring AMQP에서는 메시지가 기본적으로 지속성을 가집니다.
- 큐도 지속성이 있어야 합니다.

## 공정 배분(Fair Dispatch) vs 라운드 로빈(Round-robin) 배분
- RabbitMQ의 기본 설정은 라운드 로빈 방식으로 메시지를 배분하는 것입니다.
- 하지만 Spring AMQP에서는 기본적으로 공정 배분을 사용합니다.
- 이는 `DEFAULT_PREFETCH_COUNT` 값을 조정하여 변경할 수 있습니다.

## 핵심 메시지
- 이 튜토리얼의 핵심은 여러 작업자가 시간 소모적인 작업을 분담하여 처리할 수 있도록 하는 것입니다.
- 이는 특히 웹 애플리케이션에서 짧은 HTTP 요청 창 안에서 복잡한 작업을 처리하는 것이 불가능할 때 유용합니다.
